function AppViewModel(){function e(e){return 0===e.length||!e.trim()}function t(){y.currentNeighborhoodMarker.setMap(null),y.topPicks().forEach(function(e){e.marker.setMap(null),e.marker={}})}function o(e){var t=e.name,o={path:"M 125,5 155,90 245,90 175,145 200,230 125,180 50,230 75,145 5,90 95,90 z",fillColor:"red",fillOpacity:1,scale:.1},r=new google.maps.Marker({map:g,position:e.geometry.location,title:t,icon:o});google.maps.event.addListener(r,"click",function(){w.setContent(t),w.open(g,r)}),y.currentNeighborhoodMarker=r}function r(e){w=new google.maps.InfoWindow,m=e.geometry.location.lat(),v=e.geometry.location.lng(),y.formattedAddress(e.formatted_address);var t=new google.maps.LatLng(m,v);g.setCenter(t),o(e),n(),s(),google.maps.event.addListener(w,"closeclick",function(){y.selectedMarker().setAnimation(null)})}function n(){var e="https://api.foursquare.com/v2/venues/explore?",t="client_id=S2EMNUJJK1YLQSOOZRAUCDAGAJBYPKUQ0LJ22YGXNIKJ3Q2E&client_secret=S1SC00UAMLUAI5D3NYIM1K10QPQR4BINK4LBFZLZRGQYFRLM",o="&ll="+m+","+v,r="&query="+y.exploreKeyword(),n=e+t+"&v=20130815&venuePhotos=1"+o+r;$.ajax({url:n,success:function(e){var o=e.response.groups[0].items;o.forEach(function(e){y.topPicks.push(new Venue(e,t))}),y.topPicks().forEach(function(e){a(e),l(e)});var r=e.response.suggestedBounds;void 0!=r&&(b=new google.maps.LatLngBounds(new google.maps.LatLng(r.sw.lat,r.sw.lng),new google.maps.LatLng(r.ne.lat,r.ne.lng)),g.fitBounds(b))},complete:function(){0===y.topPicks().length&&$("#foursquare-API-error").html("<h2>No result available.</h2><h2>Please change your keywords.</h2>")},error:function(){$("#foursquare-API-error").html("<h2>There are errors when retrieving venue data. Please try refresh page later.</h2>")}})}function a(e){var t="https://irs3.4sqi.net/img/general/";$.ajax({url:e.photoAlbumnURL,dataType:"jsonp",success:function(o){var r=o.response.photos.items;for(var n in r){var a=t+"width800"+r[n].suffix,s={href:a,title:e.name};e.photoAlbumn.push(s)}},error:function(){$("#foursquare-API-error").html("<h2>There are errors when retrieving venue photo albumns. Please try refresh page later.</h2>")}});var o="#"+e.id;$(o).click(function(t){t.preventDefault(),$.swipebox(e.photoAlbumn)})}function s(){var e="https://api.forecast.io/forecast/",t="86f23490cf06571a502e3fe671ad188d",o="/"+m+","+v,r=e+t+o;$.ajax({url:r,dataType:"jsonp",success:function(e){var t=e.daily.data;t.forEach(function(){}),y.currentlyForecast(e.currently)},error:function(e){$(".current-temp-box").html("<p>Error retrieving forecast data! Try refresh page later.</p>"),$("#forecast-API-error").html("<h2>There are errors when retrieving forecast data. Please try refresh page later.</h2><p>Status: "+e.status+"</p><p>Error Type: "+e.statusText+"</p>")}})}function i(e){var t='<div class="venue-infowindow"><div class="venue-name"><a href ="'+e.foursquareUrl+'">'+e.name+'</a><span class="venue-rating badge">'+e.rating+'</span></div><div class="venue-category">'+e.categories+'</div><div class="venue-address">'+e.formattedAddress+'</div><div class="venue-contact">'+e.formattedPhone+'</div><div class="venue-url">'+e.url+"</div></div>";return t}function l(e){var t=i(e),o=new google.maps.LatLng(e.lat,e.lon),r=new google.maps.Marker({map:g,position:o,title:e.name});google.maps.event.addListener(r,"click",function(){document.getElementById(e.id).scrollIntoView();var n=jQuery.Event("click");n.stopPropagation(),$("#"+e.id).closest(".venue-listing-item").trigger("clickEvent"),y.selectedVenue(e.id),w.setContent(t),w.open(g,r),c(r),g.panTo(o)}),e.marker=r}function c(e){null==e.getAnimation()&&(y.selectedMarker(e),y.topPicks().forEach(function(e){e.marker.setAnimation(null)}),e.setAnimation(google.maps.Animation.BOUNCE))}function u(e,t){return t!=google.maps.places.PlacesServiceStatus.OK?void $("#googleMap-API-error").html("<h2>There are errors when retrieving map data.</h2><h2>Please try refresh page later.</h2>"):void(t==google.maps.places.PlacesServiceStatus.OK&&r(e[0]))}function h(e){var t={query:e};k=new google.maps.places.PlacesService(g),k.textSearch(t,u)}function p(e){h(e)}function d(){return f={zoom:15,disableDefaultUI:!0},"undefined"==typeof google?void $("#googleMap-API-error").html("<h2>There are errors when retrieving map data.</h2><h2>Please try refresh page later.</h2>"):(g=new google.maps.Map(document.getElementById("map-canvas"),f),void $("#map-canvas").height($(window).height()))}var g,f,m,v,b,k,w,y=this,P="Connecticut",A=["January","February","March","April","May","June","July","August","September","October","November","December"];y.exploreKeyword=ko.observable(""),y.neighborhood=ko.observable(P),y.formattedAddress=ko.observable(""),y.topPicks=ko.observableArray(""),y.currentlyForecast=ko.observable(""),y.selectedVenue=ko.observable(""),y.selectedMarker=ko.observable(""),y.displayForecastsList=ko.observable("false"),y.displayVenuesList=ko.observable("false");var L=$("#nytimes-header"),x=$("#nytimes-articles");L.text("New York Times Articles About "+P);var M="http://api.nytimes.com/svc/search/v2/articlesearch.json?q="+P+"&sort=newest&api-key=a36d6720b0e6e27fde6b20dc77045c40:0:71510927";$.getJSON(M,function(e){articles=e.response.docs;for(var t=0;t<articles.length;t++){var o=articles[t];x.append('<li class="article"><a href="'+o.web_url+'">'+o.headline.main+"</a><p>"+o.snippet+"</p></li>")}}).error(function(){L.text("New York Times Articles Could Not Be Loaded")}),Date.prototype.getMonthName=function(){return A[this.getMonth()]},ko.bindingHandlers.afterHtmlRender={update:function(e,t,o){o().html&&t()(o().html)}},y.updateVObservable=function(){y.displayVenuesList(!y.displayVenuesList())},y.computedNeighborhood=function(){if(!e(y.neighborhood())){t(),y.topPicks([]),h(y.neighborhood()),L.text("New York Times Articles About "+y.neighborhood());var o="http://api.nytimes.com/svc/search/v2/articlesearch.json?q="+y.neighborhood()+"&sort=newest&api-key=a36d6720b0e6e27fde6b20dc77045c40:0:71510927";x.text(""),$.getJSON(o,function(e){articles=e.response.docs;for(var t=0;t<articles.length;t++){var o=articles[t];x.append('<li class="article"><a href="'+o.web_url+'">'+o.headline.main+"</a><p>"+o.snippet+"</p></li>")}}).error(function(){L.text("New York Times Articles Could Not Be Loaded")})}},y.neighborhood.subscribe(y.computedNeighborhood),y.exploreKeyword.subscribe(y.computedNeighborhood),y.panToMarker=function(e){var t=i(e),o=new google.maps.LatLng(e.lat,e.lon);y.selectedMarker(e.marker),y.selectedVenue(e.id),w.setContent(t),w.open(g,e.marker),g.panTo(o),c(e.marker)},window.addEventListener("resize",function(){g.fitBounds(b),$("#map-canvas").height($(window).height())}),d(),p(P)}var Venue=function(e,t){this.id=e.venue.id,this.name=e.venue.name,this.lat=e.venue.location.lat,this.lon=e.venue.location.lng,this.formattedAddress=e.venue.location.formattedAddress,this.categories=e.venue.categories[0].name,this.foursquareUrl="https://foursquare.com/v/"+this.id,this.photoAlbumn=[],this.marker={},this.photoPrefix="https://irs0.4sqi.net/img/general/",this.photoPlaceHolder="http://placehold.it/100x100",this.photoSuffix,this.basePhotoAlbumnURL="https://api.foursquare.com/v2/venues/",this.photoAlbumnURL=this.getPhotoAlbumnURL(e,t),this.formattedPhone=this.getFormattedPhone(e),this.tips=this.getTips(e),this.url=this.getUrl(e),this.rating=this.getRating(e),this.featuredPhoto=this.getFeaturedPhoto(e)};Venue.prototype={getPhotoAlbumnURL:function(e,t){return this.basePhotoAlbumnURL+this.id+"/photos?"+t+"&v=20130815"},getFormattedPhone:function(e){return e.venue.contact.formattedPhone?e.venue.contact.formattedPhone:"Contact Not Available"},getTips:function(e){return e.tips?e.tips[0].text:"Tips Not Available"},getUrl:function(e){return e.venue.url?e.venue.url:"Website Not Available"},getRating:function(e){return e.venue.rating?e.venue.rating:"0.0"},getFeaturedPhoto:function(e){return e.venue.featuredPhotos?(this.photoSuffix=e.venue.featuredPhotos.items[0].suffix,this.photoPrefix+"width100"+this.photoSuffix):this.photoPlaceHolder}},$(function(){ko.applyBindings(new AppViewModel)});